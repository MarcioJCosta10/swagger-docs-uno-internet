openapi: 3.0.3
info:
  title: API Uno Internet & HubSoft
  description: Integra√ß√£o HubSoft e Blip, incluindo endpoints de cliente, financeiro, ordens de servi√ßo, desbloqueios e Router/Desk.
  version: "1.0.0"

servers:
  - url: "https://api.3mservicos.hubsoft.com.br"
    description: Servidor HubSoft
  - url: "https://unointernet.http.msging.net"
    description: Servidor Blip Router
  - url: "https://viacep.com.br/ws"
    description: API ViaCEP
  - url: "https://check-name.herokuapp.com"
    description: API Check-Name

tags:
  - name: Cliente HubSoft
    description: 
  - name: Financeiro HubSoft
    description: 
  - name: Ordem de Servi√ßo
    description: 
  - name: Desbloqueio HubSoft
    description: 
  - name: Blip Router
    description: 
  - name: Utilidades
    description: APIs externas

components:
  securitySchemes:
    ApiKeyHubSoft:
      type: apiKey
      in: header
      name: Authorization
      description: Token HubSoft ({{resource.authHubSoft}})
    ApiKeyRouter:
      type: apiKey
      in: header
      name: Authorization
      description: Token Router ({{resource.authRouter}})

paths:
  # =========================
  # HubSoft - Cliente
  # =========================
  /api/v1/integracao/cliente:
    get:
      tags:
        - Cliente HubSoft
      summary: Buscar cliente pelo CPF/CNPJ ou ID
      parameters:
        - name: busca
          in: query
          required: true
          schema:
            type: string
            enum: [cpf_cnpj, id_cliente_servico]
        - name: termo_busca
          in: query
          required: true
          schema:
            type: string
        - name: inativo
          in: query
          required: false
          schema:
            type: string
            enum: [sim, nao]
        - name: cancelado
          in: query
          required: false
          schema:
            type: string
            enum: [sim, nao]
        - name: ultima_conexao
          in: query
          required: false
          schema:
            type: string
            enum: [sim, nao]
        - name: data_inicio
          in: query
          required: false
          schema:
            type: string
            format: date
        - name: data_fim
          in: query
          required: false
          schema:
            type: string
            format: date
        - name: tipo_data
          in: query
          required: false
          schema:
            type: string
            enum: [data_vencimento, data_cadastro]
      responses:
        '200':
          description: Cliente encontrado
      security:
        - ApiKeyHubSoft: []

  /api/v1/integracao/cliente/financeiro:
    get:
      tags:
        - Financeiro HubSoft
      summary: Informa√ß√µes financeiras
      parameters:
        - name: busca
          in: query
          required: true
          schema:
            type: string
            enum: [id_cliente_servico]
        - name: termo_busca
          in: query
          required: true
          schema:
            type: string
        - name: data_inicio
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: data_fim
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: tipo_data
          in: query
          required: true
          schema:
            type: string
            enum: [data_vencimento, data_cadastro]
      responses:
        '200':
          description: Dados retornados
      security:
        - ApiKeyHubSoft: []

  /api/v1/integracao/cliente/ordem_servico:
    get:
      tags:
        - Ordem de Servi√ßo HubSoft
      summary: Ordens de servi√ßo
      parameters:
        - name: busca
          in: query
          required: true
          schema:
            type: string
            enum: [id_cliente_servico]
        - name: termo_busca
          in: query
          required: true
          schema:
            type: string
        - name: data_inicio
          in: query
          required: true
          schema:
            type: string
            format: date
        - name: data_fim
          in: query
          required: true
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Ordens de servi√ßo retornadas
      security:
        - ApiKeyHubSoft: []

  /api/v1/integracao/cliente/desbloqueio_confianca:
    get:
      tags:
        - Desbloqueio HubSoft
      summary: Desbloqueio confian√ßa
      responses:
        '200':
          description: Desbloqueios retornados
      security:
        - ApiKeyHubSoft: []

  # =========================
  # Blip Router - Commands
  # =========================
  /commands:
    post:
      tags:
        - Blip Router
      summary: Comandos no Router
      requestBody:
        required: true
        content:
          application/json:
            examples:
              GetAccount:
                summary: Buscar contato
                value:
                  id: "{{random.guid}}"
                  to: "postmaster@wa.gw.msging.net"
                  method: "get"
                  uri: "lime://wa.gw.msging.net/accounts/{{phoneNumberContact}}"
              UpdatedContact:
                summary: Atualizar contato no Router
                value:
                  id: "{{random.guid}}"
                  to: "postmaster@msging.net"
                  method: "get"
                  uri: "/contexts/{{contact.identity}}/updatedContactUnoInternet"
              ScheduleMessage:
                summary: Agendar mensagem interativa
                value:
                  id: "{{randomGuidScheduleOne}}"
                  to: "postmaster@scheduler.msging.net"
                  method: "set"
                  uri: "/schedules"
                  type: "application/vnd.iris.schedule+json"
                  resource:
                    message:
                      id: "{{randomGuidScheduleTwo}}"
                      to: "{{tunnel.originator}}"
                      type: "application/json"
                      content:
                        recipient_type: "individual"
                        type: "interactive"
                        interactive:
                          type: "button"
                          body:
                            text: "Oi *{{contact.name}}*, bom dia!\n\nNosso *time* j√° est√° *dispon√≠vel!*\n\nQuer prosseguir com seu atendimento?"
                          action:
                            buttons:
                              - type: "reply"
                                reply:
                                  id: "ID 1.1"
                                  title: "Sim, Vamos l√°!ü•≥"
                              - type: "reply"
                                reply:
                                  id: "ID 1.2"
                                  title: "N√£o, obrigado!üòâ"
                    when: "{{dataHoraSchedule}}"
                    name: "Agendamento de mensagem"
      responses:
        '200':
          description: Comando executado
      security:
        - ApiKeyRouter: []

  /messages:
    post:
      tags:
        - Blip Router
      summary: Enviar mensagem
      requestBody:
        required: true
        content:
          application/json:
            example:
              id: "{{random.guid}}"
              to: "5511999999999@wa.gw.msging.net"
              type: "application/json"
              content:
                type: "template"
                template:
                  name: "test_acompanhamento_chamadas"
                  language:
                    code: "pt_BR"
                    policy: "deterministic"
                  components:
                    - type: "body"
                      parameters:
                        - type: "text"
                          text: "Process responseAllBill"
                        - type: "text"
                          text: "Status: IC.1.0.0.1 - validate if has debit | Contato: {{contact.identity}}"
                        - type: "text"
                          text: "Response: {{responseAllBill}}"
      responses:
        '200':
          description: Mensagem enviada
      security:
        - ApiKeyRouter: []

  # =========================
  # Utilidades
  # =========================
  /ws/{cep}/json/:
    get:
      tags:
        - Utilidades
      summary: Consulta CEP
      parameters:
        - name: cep
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Endere√ßo retornado

  /verify/{nameToCallApiName}:
    get:
      tags:
        - Utilidades
      summary: Check-Name API
      parameters:
        - name: nameToCallApiName
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Resultado da verifica√ß√£o

